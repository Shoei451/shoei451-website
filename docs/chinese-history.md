# 中国王朝史年表・クイズ セットアップガイド

## 📋 Supabaseテーブルの作成

### 1. Supabaseプロジェクトにアクセス

1. [Supabase Dashboard](https://supabase.com/dashboard)にログイン
2. プロジェクトを選択
3. 左メニューから **SQL Editor** を開く

### 2. 以下のSQLを実行

```sql
-- chinese_historyテーブルの作成
CREATE TABLE chinese_history (
  id BIGSERIAL PRIMARY KEY,
  title TEXT NOT NULL,
  description TEXT,
  year INTEGER NOT NULL,  -- 紀元前は負の数で保存（例：-221 = 前221年）
  date_type TEXT DEFAULT 'year' CHECK (date_type IN ('year', 'full')),
  full_date DATE,  -- date_type='full'の場合のみ使用
  category TEXT NOT NULL CHECK (category IN ('王朝成立', '王朝滅亡', '反乱', '戦争', '外交', '内政', '経済', '文化', 'その他')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- インデックスの作成（検索パフォーマンス向上）
CREATE INDEX idx_chinese_history_year ON chinese_history(year);
CREATE INDEX idx_chinese_history_category ON chinese_history(category);

-- RLS (Row Level Security) の有効化
ALTER TABLE chinese_history ENABLE ROW LEVEL SECURITY;

-- 全ユーザーが読み取り可能
CREATE POLICY "Enable read access for all users" ON chinese_history
  FOR SELECT USING (true);

-- 全ユーザーが挿入可能
CREATE POLICY "Enable insert access for all users" ON chinese_history
  FOR INSERT WITH CHECK (true);

-- 全ユーザーが更新可能
CREATE POLICY "Enable update access for all users" ON chinese_history
  FOR UPDATE USING (true);

-- 全ユーザーが削除可能
CREATE POLICY "Enable delete access for all users" ON chinese_history
  FOR DELETE USING (true);

-- サンプルデータの挿入（任意）
INSERT INTO chinese_history (title, description, year, date_type, category) VALUES
  ('秦の統一', '始皇帝が中国を統一し、秦朝を建国', -221, 'year', '王朝成立'),
  ('秦の滅亡', '項羽と劉邦の反乱により秦朝が滅亡', -206, 'year', '王朝滅亡'),
  ('前漢の成立', '劉邦（高祖）が漢朝を建国', -202, 'year', '王朝成立'),
  ('武帝の即位', '前漢の全盛期を築く武帝が即位', -141, 'year', '内政'),
  ('張騫の西域遠征', 'シルクロード開拓の契機となる', -138, 'year', '外交'),
  ('王莽の新建国', '前漢を滅ぼし新を建国', 8, 'year', '王朝成立'),
  ('赤眉の乱', '王莽の新に対する大規模な農民反乱', 18, 'year', '反乱'),
  ('後漢の成立', '劉秀（光武帝）が後漢を建国', 25, 'year', '王朝成立'),
  ('黄巾の乱', '太平道による大規模な農民反乱', 184, 'year', '反乱'),
  ('後漢の滅亡', '献帝が退位し、後漢が滅亡', 220, 'year', '王朝滅亡'),
  ('三国時代の開始', '魏・蜀・呉の三国鼎立', 220, 'year', 'その他'),
  ('西晋の統一', '司馬炎が三国を統一', 280, 'year', '王朝成立'),
  ('八王の乱', '西晋の皇族間の内戦', 291, 'year', '反乱'),
  ('隋の統一', '隋の文帝が南北朝を統一', 589, 'year', '王朝成立'),
  ('科挙制度の開始', '隋の文帝が科挙を創設', 587, 'year', '内政'),
  ('大運河の建設', '隋の煬帝が大運河を完成', 610, 'year', '経済'),
  ('唐の成立', '李淵（高祖）が唐朝を建国', 618, 'year', '王朝成立'),
  ('貞観の治', '太宗による善政の時代', 627, 'year', '内政'),
  ('安史の乱', '安禄山・史思明の大規模な反乱', 755, 'year', '反乱'),
  ('黄巣の乱', '唐末の大規模な農民反乱', 875, 'year', '反乱'),
  ('唐の滅亡', '朱全忠により唐朝が滅亡', 907, 'year', '王朝滅亡'),
  ('宋の成立', '趙匡胤が宋朝を建国', 960, 'year', '王朝成立'),
  ('澶淵の盟', '宋と遼の和平条約', 1005, 'year', '外交'),
  ('王安石の変法', '新法による改革政策', 1069, 'year', '内政'),
  ('靖康の変', '金により北宋が滅亡', 1127, 'year', '戦争'),
  ('南宋の成立', '高宗が南宋を建国', 1127, 'year', '王朝成立'),
  ('モンゴル帝国の成立', 'チンギス・ハンがモンゴル帝国を建国', 1206, 'year', '王朝成立'),
  ('元の成立', 'フビライ・ハンが元朝を建国', 1271, 'year', '王朝成立'),
  ('南宋の滅亡', '元により南宋が滅亡', 1279, 'year', '王朝滅亡'),
  ('紅巾の乱', '元末の大規模な農民反乱', 1351, 'year', '反乱'),
  ('明の成立', '朱元璋（洪武帝）が明朝を建国', 1368, 'year', '王朝成立'),
  ('靖難の役', '永楽帝による帝位簒奪', 1399, 'year', '反乱'),
  ('鄭和の南海遠征', '大規模な海上遠征の開始', 1405, 'year', '外交'),
  ('北京遷都', '永楽帝が首都を北京に移す', 1421, 'year', '内政'),
  ('土木の変', 'オイラトに正統帝が捕らえられる', 1449, 'year', '戦争'),
  ('張居正の改革', '一条鞭法などの改革', 1573, 'year', '内政'),
  ('李自成の乱', '明末の大規模な農民反乱', 1644, 'year', '反乱'),
  ('清の成立', 'ヌルハチが後金を建国（後に清と改称）', 1616, 'year', '王朝成立'),
  ('明の滅亡', '李自成により北京が陥落', 1644, 'year', '王朝滅亡'),
  ('清の中国統一', '呉三桂の乱を平定し全土を統一', 1683, 'year', 'その他'),
  ('康熙帝の親政', '清の全盛期を築く康熙帝の親政開始', 1667, 'year', '内政'),
  ('ネルチンスク条約', 'ロシアとの国境条約', 1689, 'year', '外交'),
  ('雍正帝の即位', '清の中央集権を強化', 1722, 'year', '内政'),
  ('乾隆帝の即位', '清の最盛期', 1735, 'year', '内政'),
  ('白蓮教徒の乱', '清中期の大規模な農民反乱', 1796, 'year', '反乱'),
  ('アヘン戦争', 'イギリスとの戦争で敗北', 1840, 'year', '戦争'),
  ('南京条約', 'イギリスとの不平等条約', 1842, 'year', '外交'),
  ('太平天国の乱', '洪秀全による大規模な農民反乱', 1851, 'year', '反乱'),
  ('アロー戦争', '英仏連合軍との戦争', 1856, 'year', '戦争'),
  ('洋務運動', '西洋技術導入による近代化運動', 1861, 'year', '内政'),
  ('日清戦争', '日本との戦争で敗北', 1894, 'year', '戦争'),
  ('下関条約', '日本との講和条約', 1895, 'year', '外交'),
  ('変法運動（戊戌の変法）', '光緒帝による改革運動', 1898, 'year', '内政'),
  ('義和団事件', '外国勢力排斥運動', 1900, 'year', '反乱'),
  ('辛亥革命', '孫文らによる革命', 1911, 'year', '反乱'),
  ('清の滅亡', '宣統帝が退位し清朝が滅亡', 1912, 'year', '王朝滅亡'),
  ('中華民国の成立', '孫文が臨時大総統に就任', 1912, 'year', '王朝成立'),
  ('五・四運動', '反帝国主義・民族主義運動', 1919, 'year', 'その他'),
  ('中国国民党の成立', '孫文が国民党を改組', 1919, 'year', '内政'),
  ('中国共産党の成立', '上海で中国共産党が結成', 1921, 'year', '内政'),
  ('第一次国共合作', '国民党と共産党が協力', 1924, 'year', '内政'),
  ('北伐の開始', '蒋介石による軍閥打倒戦争', 1926, 'year', '戦争'),
  ('上海クーデター', '蒋介石が共産党を弾圧', 1927, 'year', '内政'),
  ('満州事変', '日本による満州占領', 1931, 'year', '戦争'),
  ('満州国建国', '日本の傀儡国家が建国', 1932, 'year', 'その他'),
  ('長征', '共産党の大移動', 1934, 'year', 'その他'),
  ('西安事件', '蒋介石が監禁される', 1936, 'year', 'その他'),
  ('日中戦争開始', '盧溝橋事件から全面戦争へ', 1937, 'year', '戦争'),
  ('第二次国共合作', '抗日統一戦線の形成', 1937, 'year', '内政'),
  ('国共内戦再開', '第二次世界大戦後の内戦', 1946, 'year', '戦争'),
  ('中華人民共和国成立', '毛沢東が建国を宣言', 1949, 'year', '王朝成立'),
  ('中華民国の台湾移転', '国民党政府が台湾に移る', 1949, 'year', 'その他'),
  ('大躍進政策', '急進的な経済政策', 1958, 'year', '経済'),
  ('文化大革命', '毛沢東による政治運動', 1966, 'year', '内政'),
  ('中ソ対立の激化', 'ソ連との関係悪化', 1969, 'year', '外交'),
  ('ニクソン訪中', '米中関係の改善', 1972, 'year', '外交'),
  ('毛沢東の死去', '文化大革命の終焉', 1976, 'year', 'その他'),
  ('改革開放政策', '鄧小平による経済改革', 1978, 'year', '経済'),
  ('天安門事件', '民主化運動の弾圧', 1989, 'year', '内政'),
  ('香港返還', 'イギリスから香港が返還', 1997, 'year', '外交'),
  ('マカオ返還', 'ポルトガルからマカオが返還', 1999, 'year', '外交'),
  ('WTO加盟', '世界貿易機関への加盟', 2001, 'year', '経済');
```

## 📁 ファイル構成

### 公開ファイル
- **chinese-history-timeline.html** - 中国王朝史年表（CRUD機能付き）
- **chinese-history-quiz.html** - 年代当てクイズ

## 🎨 カテゴリとカラー

| カテゴリ | 色 | 説明 |
|---------|---|------|
| 王朝成立 | 青系 | 新王朝の建国 |
| 王朝滅亡 | 黄色系 | 王朝の終焉 |
| 反乱 | 濃青系 | 農民反乱・クーデター |
| 戦争 | 緑系 | 対外戦争・内戦 |
| 外交 | 薄緑系 | 条約・外交関係 |
| 内政 | ティール系 | 政治改革・制度 |
| 経済 | ピンク系 | 経済政策・発展 |
| 文化 | オレンジ系 | 文化・学問 |
| その他 | 紫系 | 上記以外 |

## 💡 使い方

### 年表アプリ
1. HTMLファイルを開く
2. イベントの閲覧、検索
3. カテゴリごとのフィルタリング
4. 「+ イベント追加」から新規作成
5. 各イベントの編集・削除

### クイズアプリ
1. HTMLファイルを開く
2. 出題カテゴリを選択（複数可）
3. 出題数を設定（5〜50問）
4. 年を入力して回答
   - 紀元前は負の数で入力（例：-221 = 前221年）
5. 結果確認と復習

## 📝 データ追加のヒント

### 紀元前の年号
- データベースでは負の整数で保存
- 例：紀元前221年 → `-221`
- 入力時は負の数で（例：-221）
- 表示時は自動で「前221年」に変換

### 年のみ vs 完全な日付
- `date_type: 'year'` → 年のみ表示
- `date_type: 'full'` → 完全な日付表示

### カテゴリ選択の基準
- **王朝成立/滅亡**: 明確な建国・滅亡イベント
- **反乱**: 民衆蜂起、クーデター
- **戦争**: 対外戦争、大規模な軍事衝突
- **外交**: 条約締結、外交関係
- **内政**: 制度改革、政治運動
- **経済**: 経済政策、貿易
- **文化**: 学問、芸術、宗教
- **その他**: 分類困難なもの

## 🔧 カスタマイズ

### カテゴリの追加
1. SQLの`CHECK`制約を更新
2. HTMLのカテゴリリストを更新
3. CSSのカラー定義を追加

### RLSポリシーの変更
管理者のみ編集可能にする場合：
```sql
DROP POLICY "Enable update access for all users" ON chinese_history;
DROP POLICY "Enable delete access for all users" ON chinese_history;

-- Service Role のみ編集・削除可能
CREATE POLICY "Enable update for service role only" ON chinese_history
  FOR UPDATE USING (auth.role() = 'service_role');

CREATE POLICY "Enable delete for service role only" ON chinese_history
  FOR DELETE USING (auth.role() = 'service_role');
```

---

**作成日**: 2026年1月19日  
**テーブル名**: `chinese_history`  
**対応アプリ**: 中国王朝史年表、年代当てクイズ
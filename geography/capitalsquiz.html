<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="../images/favicon.ico" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>World Capitals Quiz ‚Äî Shoei451</title>
<link rel="stylesheet" href="../css/common.css">
<style>
/* Quiz-specific styles */
.quiz-wrapper {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
}

.quiz-box {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 20px;
  box-shadow: 0 10px 30px var(--shadow);
  text-align: center;
  animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.quiz-box h2 {
  color: var(--primary);
  font-size: 2rem;
  margin-bottom: 20px;
}

.quiz-image {
  max-width: 100%;
  height: auto;
  border-radius: 12px;
  margin: 20px 0;
  box-shadow: 0 4px 15px var(--shadow);
}

.flag {
  width: 180px;
  max-width: 100%;
  margin: 1.5rem auto;
  border: 2px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 4px 12px var(--shadow);
}

.field {
  margin: 20px 0;
}

.field label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--primary);
}

.field select {
  width: 100%;
  max-width: 300px;
  padding: 12px;
  border-radius: 12px;
  border: 2px solid var(--accent);
  background: var(--theme);
  color: var(--content);
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s;
}

.field select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(250, 186, 64, 0.2);
}

button {
  background: var(--accent);
  color: var(--primary);
  border: #1a2b3c 2px solid;
  border-radius: 25px;
  padding: 14px 32px;
  margin: 12px 8px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: 600;
  transition: all 0.3s;
  box-shadow: 0 4px 15px var(--shadow);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
  opacity: 0.9;
}

.options {
  margin: 24px 0;
}

.options button {
  display: block;
  width: 100%;
  max-width: 500px;
  margin: 12px auto;
  text-align: left;
  padding: 16px 20px;
  font-size: 1rem;
  background: var(--theme);
  border: 2px solid var(--accent);
}

.options button:hover {
  background: var(--primary);
  color: #ffffff;
  border-color: var(--primary);
}

#country {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary);
  margin: 20px 0;
}

#score {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 20px;
}

/* Progress Bar */
#progressOuter {
  width: 100%;
  height: 12px;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 6px;
  overflow: hidden;
  margin: 16px 0;
  box-shadow: inset 0 2px 4px var(--shadow);
}

body.dark #progressOuter {
  background: rgba(255, 255, 255, 0.1);
}

#progressBar {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  transition: width 0.3s;
  border-radius: 6px;
}

#result {
  font-size: 1.2rem;
  font-weight: 700;
  margin: 20px 0;
  min-height: 30px;
}

@keyframes correctAnim {
  0% { transform: scale(1); color: #4CAF50; }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

@keyframes wrongAnim {
  0% { transform: translateX(0); color: #F44336; }
  25% { transform: translateX(-10px); }
  50% { transform: translateX(10px); }
  75% { transform: translateX(-10px); }
  100% { transform: translateX(0); }
}

#result.correct {
  animation: correctAnim 0.6s ease;
  color: #4CAF50;
}

#result.wrong {
  animation: wrongAnim 0.6s ease;
  color: #F44336;
}

.note {
  font-size: 0.9rem;
  color: var(--secondary);
  margin-top: 20px;
  line-height: 1.6;
}

.note a {
  color: whitesmoke;
  text-decoration: underline;
}

.note a:hover {
  color: var(--primary);
}

@media (max-width: 768px) {
  .quiz-box {
    padding: 1.5rem;
  }

  .quiz-box h2 {
    font-size: 1.5rem;
  }

  .flag {
    width: 140px;
  }

  #country {
    font-size: 1.2rem;
  }

  button {
    font-size: 1rem;
    padding: 12px 24px;
  }

  .options button {
    padding: 14px 16px;
    font-size: 0.95rem;
  }
}
</style>
</head>

<body>

<!-- Theme Toggle -->
<span class="logo-switches">
  <button id="theme-toggle" title="Toggle Theme">
    <svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
    <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </button>
</span>

<!-- Header -->
<header>
  <h1>üèõÔ∏è World Capitals Quiz</h1>
  <p>Test your knowledge of world capitals</p>
</header>

<div class="quiz-wrapper">
  <a href="index.html" class="back-link">Back to Geography</a>

  <!-- Start Screen -->
  <div class="quiz-box" id="startScreen">
    <h2>World Capitals Quiz</h2>
    <img src="../images/capital-quiz.webp" alt="World Capitals" class="quiz-image">

    <div class="field">
      <label for="questionCount">Âá∫È°åÊï∞Ôºö</label>
      <select id="questionCount">
        <option value="5">5Âïè</option>
        <option value="10" selected>10Âïè</option>
        <option value="20">20Âïè</option>
        <option value="30">30Âïè</option>
      </select>
    </div>

    <div class="field">
      <label for="regionSelect">Âú∞ÂüüÔºö</label>
      <select id="regionSelect">
        <option value="all">ÂÖ®‰∏ñÁïå</option>
        <option value="asia">„Ç¢„Ç∏„Ç¢</option>
        <option value="europe">„É®„Éº„É≠„ÉÉ„Éë</option>
        <option value="africa">„Ç¢„Éï„É™„Ç´</option>
        <option value="americas">„Ç¢„É°„É™„Ç´Â§ßÈô∏</option>
        <option value="oceania">„Ç™„Çª„Ç¢„Éã„Ç¢</option>
      </select>
    </div>

    <button onclick="startGame()">START</button>

    <p class="note">
      ‚ÄªÁîªÂÉè„ÅØ‰∏ãË®ò„Çµ„Ç§„Éà„Çà„Çä‰Ωø„Çè„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü<br>
      <a href="https://visit-idea.com/en/quiz/quiz-capital-medium" target="_blank" rel="noopener">https://visit-idea.com/en/quiz/quiz-capital-medium</a>
    </p>
  </div>

  <!-- Quiz Screen -->
  <div class="quiz-box" id="quizScreen" style="display:none;">
    <div id="score">Score: 0 / 0</div>
    <div id="progressOuter">
      <div id="progressBar"></div>
    </div>

    <img id="flag" class="flag" alt="Flag" />
    <div id="country"></div>
    <div class="options" id="options"></div>
    <div id="result"></div>

    <button onclick="goToTop()">Go Back to the Top</button>
  </div>
</div>

<!-- Footer -->
<footer>
  <p>Get in touch: <a href="mailto:okamotoshoei451@gmail.com">okamotoshoei451@gmail.com</a></p>
</footer>

<script src="countries_data.js"></script>
<script>
// Theme Toggle
if (localStorage.getItem("pref-theme") === "dark") {
  document.body.classList.add('dark');
} else if (localStorage.getItem("pref-theme") === "light") {
  document.body.classList.remove('dark');
} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.body.classList.add('dark');
}

const themeToggle = document.getElementById('theme-toggle');
themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark');
  if (document.body.classList.contains('dark')) {
    localStorage.setItem('pref-theme', 'dark');
  } else {
    localStorage.setItem('pref-theme', 'light');
  }
});

// Quiz Logic
let quizList = [];
let index = 0;
let correct = 0;
let questionCount = 10;
let currentAnswer = "";
let currentAnswerJP = "";

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function updateProgress() {
  const progress = (index / quizList.length) * 100;
  document.getElementById('progressBar').style.width = progress + '%';
}

function startGame() {
  document.getElementById("startScreen").style.display = "none";
  document.getElementById("quizScreen").style.display = "block";

  questionCount = Number(document.getElementById("questionCount").value);
  const region = document.getElementById("regionSelect").value;

  quizList = region === "all"
    ? [...countries]
    : countries.filter(c => c.region === region);

  shuffle(quizList);
  quizList = quizList.slice(0, questionCount);

  index = 0;
  correct = 0;
  updateProgress();
  loadQuestion();
}

function loadQuestion() {
  if (index >= quizList.length) {
    const percentage = Math.round((correct / quizList.length) * 100);
    document.getElementById("result").innerHTML = `
      <strong>Quiz Complete!</strong><br>
      Final Score: ${correct} / ${quizList.length} (${percentage}%)
    `;
    document.getElementById("flag").style.display = "none";
    document.getElementById("country").textContent = "";
    document.getElementById("options").innerHTML = "";
    return;
  }

  const q = quizList[index];
  currentAnswer = q.capital;
  currentAnswerJP = q.capitalJP;

  document.getElementById("flag").style.display = "block";
  document.getElementById("flag").src = `https://flagcdn.com/w320/${q.code}.png`;
  document.getElementById("country").textContent = q.country;
  document.getElementById("result").textContent = "";

  let options = [q.capital];
  while (options.length < 4) {
    let r = countries[Math.floor(Math.random() * countries.length)].capital;
    if (!options.includes(r)) options.push(r);
  }

  shuffle(options);

  const box = document.getElementById("options");
  box.innerHTML = "";
  options.forEach(opt => {
    const countryObj = countries.find(c => c.capital === opt);
    const btn = document.createElement("button");
    btn.innerHTML = `${countryObj.capital}<br><small>${countryObj.capitalJP}</small>`;
    btn.onclick = () => showAnswer(opt);
    box.appendChild(btn);
  });

  updateProgress();
}

function showAnswer(sel) {
  const result = document.getElementById("result");
  
  result.classList.remove("correct", "wrong");
  void result.offsetWidth;

  index++;

  if (sel === currentAnswer) {
    correct++;
    result.textContent = "Correct!";
    result.classList.add("correct");
  } else {
    result.textContent = "Wrong! Answer: " + currentAnswer + " (" + currentAnswerJP + ")";
    result.classList.add("wrong");
  }

  document.getElementById("score").textContent = `Score: ${correct} / ${index}`;

  // Disable all buttons
  document.querySelectorAll("#options button").forEach(btn => {
    btn.disabled = true;
    btn.style.cursor = "not-allowed";
    btn.style.opacity = "0.6";
  });

  setTimeout(() => {
    loadQuestion();
  }, 1500);
}

function goToTop() {
  document.getElementById("quizScreen").style.display = "none";
  document.getElementById("startScreen").style.display = "block";
  document.getElementById("result").textContent = "";
  document.getElementById("score").textContent = "Score: 0 / 0";
  document.getElementById("progressBar").style.width = "0%";
}
</script>

</body>
</html>
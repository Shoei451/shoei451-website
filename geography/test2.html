<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åœ°ç† - ãƒ‡ãƒãƒƒã‚°ç‰ˆ</title>
<link rel="icon" href="../images/favicon.png" />
<link rel="stylesheet" href="../css/common.css">
</head>
<body>

<div style="max-width: 1000px; margin: 50px auto; padding: 20px;">
    <h1>ğŸ” åœ°ç† - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰</h1>
    
    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <h3>è¨­å®š</h3>
        <label>Supabase URL:</label>
        <input type="text" id="urlInput" style="width: 100%; padding: 10px; margin: 5px 0;" 
               placeholder="https://xxx.supabase.co" value="YOUR_SUPABASE_URL">
        
        <label>Supabase Key:</label>
        <input type="text" id="keyInput" style="width: 100%; padding: 10px; margin: 5px 0;" 
               placeholder="eyJhbGci..." value="YOUR_SUPABASE_ANON_KEY">
        
        <button onclick="testAll()" style="margin-top: 10px; padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
            å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </button>
    </div>
    
    <div id="results" style="margin-top: 20px;"></div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
async function testAll() {
    const url = document.getElementById('urlInput').value.trim();
    const key = document.getElementById('keyInput').value.trim();
    const resultsDiv = document.getElementById('results');
    
    if (url === 'YOUR_SUPABASE_URL' || !url) {
        alert('Supabase URLã‚’è¨­å®šã—ã¦ãã ã•ã„');
        return;
    }
    
    if (key === 'YOUR_SUPABASE_ANON_KEY' || !key) {
        alert('Supabase Keyã‚’è¨­å®šã—ã¦ãã ã•ã„');
        return;
    }
    
    const client = supabase.createClient(url, key);
    resultsDiv.innerHTML = '<h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h2>';
    
    const tests = [
        'geography',
        'geography/',
        'geography/2025-term1',
        'geography/2025-term1/',
        'geography/2025-term2',
        'geography/2025-term3',
        '2025-term1/geography',
        'exam-papers/geography/2025-term1',
    ];
    
    let html = '<h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>';
    
    for (const path of tests) {
        console.log(`Testing: ${path}`);
        
        try {
            const { data: files, error } = await client
                .storage
                .from('exam-papers')
                .list(path, {
                    limit: 100,
                    offset: 0,
                    sortBy: { column: 'name', order: 'asc' }
                });
            
            const fileCount = files ? files.length : 0;
            const pdfCount = files ? files.filter(f => f.name.endsWith('.pdf')).length : 0;
            
            if (error) {
                html += `
                    <div style="background: #f8d7da; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <strong>âŒ ${path}</strong><br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message || JSON.stringify(error)}
                    </div>
                `;
            } else if (fileCount === 0) {
                html += `
                    <div style="background: #fff3cd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong>âš ï¸ ${path}</strong><br>
                        ãƒ•ã‚¡ã‚¤ãƒ«: 0å€‹
                    </div>
                `;
            } else {
                html += `
                    <div style="background: #d4edda; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #28a745;">
                        <strong>âœ… ${path}</strong><br>
                        ãƒ•ã‚¡ã‚¤ãƒ«: ${fileCount}å€‹ (PDF: ${pdfCount}å€‹)<br>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer;">ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤º</summary>
                            <ul style="margin-top: 10px;">
                                ${files.map(f => `<li>${f.name} ${f.name.endsWith('.pdf') ? 'ğŸ“„' : 'ğŸ“'}</li>`).join('')}
                            </ul>
                        </details>
                    </div>
                `;
            }
        } catch (e) {
            html += `
                <div style="background: #f8d7da; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #dc3545;">
                    <strong>ğŸ’¥ ${path}</strong><br>
                    ä¾‹å¤–: ${e.message}
                </div>
            `;
        }
    }
    
    html += `
        <div style="background: #e7f3ff; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #2196F3;">
            <h3>ğŸ“Œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
            <p><strong>âœ… ç·‘è‰²ï¼ˆæˆåŠŸï¼‰ã®ãƒ‘ã‚¹</strong>ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚</p>
            <p>ãã®ãƒ‘ã‚¹ã‚’HTMLãƒ•ã‚¡ã‚¤ãƒ«ã® <code>loadExamPapers()</code> é–¢æ•°ã§ä½¿ç”¨ã—ã¾ã™ã€‚</p>
            <p>ä¾‹: <code>.list('geography/2025-term1', { ... })</code></p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
}

window.addEventListener('DOMContentLoaded', () => {
    console.log('Supabase library:', typeof supabase !== 'undefined' ? 'OK' : 'NG');
});
</script>

</body>
</html>
let state = { mode: 'menu', previousMode: null, currentQuestion: 0, score: 0, quizQuestions: [], selectedAnswer: null, showResult: false, multiSelectAnswers: new Set(), matchingData: null, selectedMatch: null, groupingData: null, draggedItem: null, timelineData: null };
function shuffle(arr) { return [...arr].sort(() => Math.random()-0.5); }
function resetState() { state.currentQuestion=0; state.score=0; state.quizQuestions=[]; state.selectedAnswer=null; state.showResult=false; state.multiSelectAnswers=new Set(); state.matchingData=null; state.selectedMatch=null; state.groupingData=null; state.timelineData=null; }
function generatePersonToDynastyQuiz() { const shuffled=shuffle(quizData); state.quizQuestions=shuffled.slice(0,10).map(person=>{ const wrongDynasties=dynasties.filter(d=>d!==person.dynasty).sort(()=>Math.random()-0.5).slice(0,3); const options=shuffle([...wrongDynasties,person.dynasty]); return {question:person.name,options,correct:person.dynasty,type:'single'}; }); }
function generateDynastyToPeopleQuiz() { const questions=dynasties.map(dynasty=>{ const correctPeople=quizData.filter(p=>p.dynasty===dynasty); const wrongPeople=quizData.filter(p=>p.dynasty!==dynasty).sort(()=>Math.random()-0.5).slice(0,4); const options=shuffle([...correctPeople,...wrongPeople]).map(p=>p.name); return {question:dynasty,options,correct:correctPeople.map(p=>p.name),type:'multiple'}; }); state.quizQuestions=shuffle(questions).slice(0,5); }
function generateMatchingQuiz() { const shuffled=shuffle(quizData.filter(p=>p.works.length>0)).slice(0,6); const people=shuffled.map((p,idx)=>({id:`person-${idx}`,text:p.name,type:'person'})); const works=shuffle(shuffled.map((p,idx)=>({id:`work-${idx}`,text:p.works[0],type:'work'}))); state.matchingData={people,works,matched:[],correctMatches:shuffled.map(p=>({person:p.name,work:p.works[0]}))}; }
function generateGroupingQuiz() { const items=shuffle(quizData).slice(0,12); const groups={}; categories.forEach(cat=>groups[cat]=[]); state.groupingData={ungrouped:items.map(p=>({name:p.name,category:p.category})),groups,categories}; }
function generateTimelineQuiz() { const items=shuffle(quizData).slice(0,6); state.timelineData={items:shuffle(items.map(p=>({name:p.name,dynasty:p.dynasty,era:p.era}))),correctOrder:items.sort((a,b)=>a.era-b.era).map(p=>p.name)}; }
function generateTrueFalseQuiz() { const allStatements=[]; quizData.forEach(person=>{ allStatements.push({statement:`${person.name}ã¯${person.dynasty}ã®äººç‰©ã§ã‚ã‚‹`,correct:true}); }); quizData.filter(p=>p.works.length>0).forEach(person=>{ allStatements.push({statement:`${person.name}ã®ä»£è¡¨ä½œã«ã€${person.works[0]}ã€ãŒã‚ã‚‹`,correct:true}); }); quizData.forEach(person=>{ const wrongDynasty=dynasties.filter(d=>d!==person.dynasty)[Math.floor(Math.random()*(dynasties.length-1))]; allStatements.push({statement:`${person.name}ã¯${wrongDynasty}ã®äººç‰©ã§ã‚ã‚‹`,correct:false}); }); const peopleWithWorks=quizData.filter(p=>p.works.length>0); peopleWithWorks.forEach(person=>{ const otherPerson=peopleWithWorks.filter(p=>p.name!==person.name)[Math.floor(Math.random()*(peopleWithWorks.length-1))]; if(otherPerson){ allStatements.push({statement:`${person.name}ã®ä»£è¡¨ä½œã«ã€${otherPerson.works[0]}ã€ãŒã‚ã‚‹`,correct:false}); } }); state.quizQuestions=shuffle(allStatements).slice(0,10).map(s=>({question:s.statement,correct:s.correct,type:'truefalse'})); }
function startQuiz(quizMode) { resetState(); state.mode=quizMode; state.previousMode=quizMode; if(quizMode==='person-to-dynasty'){ generatePersonToDynastyQuiz(); }else if(quizMode==='dynasty-to-people'){ generateDynastyToPeopleQuiz(); }else if(quizMode==='matching'){ generateMatchingQuiz(); }else if(quizMode==='grouping'){ generateGroupingQuiz(); }else if(quizMode==='timeline'){ generateTimelineQuiz(); }else if(quizMode==='truefalse'){ generateTrueFalseQuiz(); } render(); }
function handleAnswer(answer) { if(state.showResult)return; state.selectedAnswer=answer; state.showResult=true; const current=state.quizQuestions[state.currentQuestion]; if(current.type==='single'&&answer===current.correct){ state.score++; }else if(current.type==='truefalse'&&answer===current.correct){ state.score++; } render(); }
function handleMultiSelect(answer) { if(state.multiSelectAnswers.has(answer)){ state.multiSelectAnswers.delete(answer); }else{ state.multiSelectAnswers.add(answer); } render(); }
function submitMultiSelect() { if(state.showResult)return; state.showResult=true; const current=state.quizQuestions[state.currentQuestion]; const correctSet=new Set(current.correct); if(state.multiSelectAnswers.size===correctSet.size&&[...state.multiSelectAnswers].every(a=>correctSet.has(a))){ state.score++; } render(); }
function nextQuestion() { if(state.currentQuestion<state.quizQuestions.length-1){ state.currentQuestion++; state.selectedAnswer=null; state.showResult=false; state.multiSelectAnswers=new Set(); }else{ state.mode='results'; } render(); }
function handleMatching(item) { if(!state.selectedMatch){ state.selectedMatch=item; }else{ if(state.selectedMatch.type!==item.type){ const person=state.selectedMatch.type==='person'?state.selectedMatch:item; const work=state.selectedMatch.type==='work'?state.selectedMatch:item; const isCorrect=state.matchingData.correctMatches.some(m=>m.person===person.text&&m.work===work.text); if(isCorrect){ state.matchingData.matched.push({person:person.text,work:work.text}); state.score++; } } state.selectedMatch=null; } render(); }
function handleDragStart(item,event) { state.draggedItem=item; event.target.classList.add('dragging'); }
function handleDragEnd(event) { event.target.classList.remove('dragging'); }
function handleDragOver(event) { event.preventDefault(); if(event.currentTarget.classList.contains('category-box')){ event.currentTarget.classList.add('drag-over'); } }
function handleDragLeave(event) { if(event.currentTarget.classList.contains('category-box')){ event.currentTarget.classList.remove('drag-over'); } }
function handleDrop(category,event) { event.preventDefault(); if(event.currentTarget.classList.contains('category-box')){ event.currentTarget.classList.remove('drag-over'); } if(!state.draggedItem)return; state.groupingData.ungrouped=state.groupingData.ungrouped.filter(i=>i.name!==state.draggedItem.name); Object.keys(state.groupingData.groups).forEach(cat=>{ state.groupingData.groups[cat]=state.groupingData.groups[cat].filter(i=>i.name!==state.draggedItem.name); }); state.groupingData.groups[category].push(state.draggedItem); if(state.draggedItem.category===category){ state.score++; } state.draggedItem=null; render(); }
let timelineDraggedIndex=null;
function handleTimelineDragStart(index,event) { timelineDraggedIndex=index; event.target.classList.add('dragging'); }
function handleTimelineDragEnd(event) { event.target.classList.remove('dragging'); timelineDraggedIndex=null; }
function handleTimelineDragOver(event) { event.preventDefault(); }
function handleTimelineDrop(dropIndex,event) { event.preventDefault(); if(timelineDraggedIndex===null||timelineDraggedIndex===dropIndex)return; const items=[...state.timelineData.items]; const [draggedItem]=items.splice(timelineDraggedIndex,1); items.splice(dropIndex,0,draggedItem); state.timelineData.items=items; render(); }
function submitTimeline() { const userOrder=state.timelineData.items.map(i=>i.name); const correctOrder=state.timelineData.correctOrder; if(JSON.stringify(userOrder)===JSON.stringify(correctOrder)){ state.score=state.timelineData.items.length; }else{ userOrder.forEach((name,idx)=>{ if(name===correctOrder[idx]){ state.score++; } }); } state.mode='results'; render(); }
function resetToMenu() { state.mode='menu'; resetState(); render(); }
function renderControlBar() { return `<div class="control-bar"><button class="control-btn" onclick="resetToMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button><button class="control-btn" onclick="startQuiz('${state.previousMode}')">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button></div>`; }
function renderMenu() { return `<div class="pattern-bg"><div class="text-center mb-6 animate-fadeIn"><h1 class="title-chinese">ä¸­å›½ç‹æœæ–‡åŒ–å²</h1><div class="seal-stamp">ã‚¯ã‚¤ã‚º</div><p style="margin-top:1.5rem;color:#6b7280;font-size:1.125rem;">å­¦ç¿’å½¢å¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p></div><div class="grid-3"><div class="quiz-card animate-slideUp-1" onclick="startQuiz('person-to-dynasty')"><h3>äººç‰©â†’ç‹æœ</h3><p>äººç‰©åã‹ã‚‰æ´»èºã—ãŸç‹æœã‚’é¸æŠ</p><div class="meta">4æŠå•é¡Œ â€¢ 10å•</div></div><div class="quiz-card animate-slideUp-2" onclick="startQuiz('dynasty-to-people')"><h3>ç‹æœâ†’äººç‰©</h3><p>ç‹æœã«è©²å½“ã™ã‚‹äººç‰©ã‚’å…¨ã¦é¸æŠ</p><div class="meta">è¤‡æ•°é¸æŠ â€¢ 5å•</div></div><div class="quiz-card animate-slideUp-3" onclick="startQuiz('matching')"><h3>äººç‰©ã¨ä½œå“</h3><p>äººç‰©åã¨ä»£è¡¨ä½œå“ã‚’ãƒãƒƒãƒãƒ³ã‚°</p><div class="meta">ãƒãƒƒãƒãƒ³ã‚° â€¢ 6çµ„</div></div><div class="quiz-card animate-slideUp-4" onclick="startQuiz('grouping')"><h3>ã‚«ãƒ†ã‚´ãƒªåˆ†é¡</h3><p>äººç‰©ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°</p><div class="meta">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— â€¢ 12äºº</div></div><div class="quiz-card animate-slideUp-5" onclick="startQuiz('timeline')"><h3>æ™‚ä»£é †ä¸¦ã¹æ›¿ãˆ</h3><p>äººç‰©ã‚’å¤ã„é †ã«ä¸¦ã¹æ›¿ãˆ</p><div class="meta">ä¸¦ã¹æ›¿ãˆ â€¢ 6äºº</div></div><div class="quiz-card animate-slideUp-6" onclick="startQuiz('truefalse')"><h3>â—¯âœ—å•é¡Œ</h3><p>è¨˜è¿°ã®æ­£èª¤ã‚’åˆ¤å®š</p><div class="meta">æ­£èª¤å•é¡Œ â€¢ 10å•</div></div></div></div>`; }
function renderQuiz() { const current=state.quizQuestions[state.currentQuestion]; const isMultiple=current.type==='multiple'; let optionsHtml=''; current.options.forEach((option,idx)=>{ const isSelected=isMultiple?state.multiSelectAnswers.has(option):state.selectedAnswer===option; const isCorrect=isMultiple?current.correct.includes(option):option===current.correct; let className='option-btn'; let iconHtml=''; if(state.showResult){ if(isMultiple){ if(isCorrect&&state.multiSelectAnswers.has(option)){ className+=' correct'; iconHtml='<span class="icon check">âœ“</span>'; }else if(isCorrect&&!state.multiSelectAnswers.has(option)){ className+=' missed'; iconHtml='<span class="icon info">âœ“</span>'; }else if(!isCorrect&&state.multiSelectAnswers.has(option)){ className+=' incorrect'; iconHtml='<span class="icon x">âœ—</span>'; } }else{ if(option===current.correct){ className+=' correct'; iconHtml='<span class="icon check">âœ“</span>'; }else if(isSelected){ className+=' incorrect'; iconHtml='<span class="icon x">âœ—</span>'; } } }else if(isSelected){ className+=' selected'; } const onClick=isMultiple?`handleMultiSelect('${option.replace(/'/g,"\\'")}')`:`handleAnswer('${option.replace(/'/g,"\\'")}')`; const disabled=state.showResult&&!isMultiple?'disabled':''; optionsHtml+=`<button class="${className}" onclick="${onClick}" ${disabled}>${option}${iconHtml}</button>`; }); let actionButton=''; if(isMultiple&&!state.showResult){ const disabled=state.multiSelectAnswers.size===0?'disabled':''; actionButton=`<button class="submit-btn" onclick="submitMultiSelect()" ${disabled}>è§£ç­”ã‚’ç¢ºå®š</button>`; }else if(state.showResult){ const text=state.currentQuestion<state.quizQuestions.length-1?'æ¬¡ã®å•é¡Œ':'çµæœã‚’è¦‹ã‚‹'; actionButton=`<button class="next-btn" onclick="nextQuestion()">${text} â†’</button>`; } return `${renderControlBar()}<div class="quiz-container"><div class="quiz-header"><div>å•é¡Œ ${state.currentQuestion+1} / ${state.quizQuestions.length}</div><div class="score">æ­£è§£: ${state.score}</div></div><div class="quiz-box"><h2 class="question-title">${current.question}</h2><p class="question-subtitle">${isMultiple?'è©²å½“ã™ã‚‹äººç‰©ã‚’å…¨ã¦é¸æŠã—ã¦ãã ã•ã„':'ã“ã®äººç‰©ãŒæ´»èºã—ãŸç‹æœã¯ï¼Ÿ'}</p><div class="options-grid">${optionsHtml}</div>${actionButton}</div></div>`; }
function renderTrueFalse() { const current=state.quizQuestions[state.currentQuestion]; const trueSelected=state.selectedAnswer===true; const falseSelected=state.selectedAnswer===false; let trueClass='tf-btn'; let falseClass='tf-btn'; if(state.showResult){ if(current.correct===true){ trueClass+=' correct'; if(falseSelected)falseClass+=' incorrect'; }else{ falseClass+=' correct'; if(trueSelected)trueClass+=' incorrect'; } }else{ if(trueSelected)trueClass+=' selected'; if(falseSelected)falseClass+=' selected'; } const disabled=state.showResult?'disabled':''; return `${renderControlBar()}<div class="quiz-container"><div class="quiz-header"><div>å•é¡Œ ${state.currentQuestion+1} / ${state.quizQuestions.length}</div><div class="score">æ­£è§£: ${state.score}</div></div><div class="quiz-box"><h2 class="question-title">${current.question}</h2><p class="question-subtitle">ã“ã®è¨˜è¿°ã¯æ­£ã—ã„ã§ã™ã‹ï¼Ÿ</p><div class="tf-options"><button class="${trueClass}" onclick="handleAnswer(true)" ${disabled}>â—¯ æ­£ã—ã„</button><button class="${falseClass}" onclick="handleAnswer(false)" ${disabled}>âœ— é–“é•ã„</button></div>${state.showResult?`<button class="next-btn" onclick="nextQuestion()">${state.currentQuestion<state.quizQuestions.length-1?'æ¬¡ã®å•é¡Œ':'çµæœã‚’è¦‹ã‚‹'} â†’</button>`:''}</div></div>`; }
function renderMatching() { const isMatched=(text,type)=>state.matchingData.matched.some(m=>type==='person'?m.person===text:m.work===text); const isSelected=(id)=>state.selectedMatch?.id===id; let peopleHtml=''; state.matchingData.people.forEach(person=>{ const matched=isMatched(person.text,'person'); const selected=isSelected(person.id); const className=matched?'matching-btn':selected?'matching-btn selected':'matching-btn'; const disabled=matched?'disabled':''; const itemJson=JSON.stringify(person).replace(/"/g,'&quot;'); peopleHtml+=`<button class="${className}" onclick='handleMatching(${itemJson})' ${disabled}>${person.text}</button>`; }); let worksHtml=''; state.matchingData.works.forEach(work=>{ const matched=isMatched(work.text,'work'); const selected=isSelected(work.id); const className=matched?'matching-btn':selected?'matching-btn selected':'matching-btn'; const disabled=matched?'disabled':''; const itemJson=JSON.stringify(work).replace(/"/g,'&quot;'); worksHtml+=`<button class="${className}" onclick='handleMatching(${itemJson})' ${disabled}>${work.text}</button>`; }); const allMatched=state.matchingData.matched.length===state.matchingData.people.length; return `${renderControlBar()}<div class="matching-container"><div class="text-center mb-6"><h2 class="question-title">äººç‰©ã¨ä½œå“ã®ãƒãƒƒãƒãƒ³ã‚°</h2><p class="question-subtitle">äººç‰©ã¨ä½œå“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµ„ã¿åˆã‚ã›ã¦ãã ã•ã„</p><div style="margin-top:1rem;font-size:1.25rem;font-weight:bold;color:#b45309;">æ­£è§£: ${state.score} / ${state.matchingData.people.length}</div></div><div class="matching-grid"><div class="matching-column"><h3>äººç‰©</h3><div class="matching-items">${peopleHtml}</div></div><div class="matching-column"><h3>ä½œå“</h3><div class="matching-items">${worksHtml}</div></div></div>${allMatched?'<button class="menu-btn" onclick="resetToMenu()" style="margin-top:2rem;">çµæœã‚’è¦‹ã‚‹ â†’</button>':''}</div>`; }
function renderGrouping() { let ungroupedHtml=''; state.groupingData.ungrouped.forEach(item=>{ const itemJson=JSON.stringify(item).replace(/"/g,'&quot;'); ungroupedHtml+=`<div class="draggable-item" draggable="true" ondragstart="handleDragStart(${itemJson},event)" ondragend="handleDragEnd(event)">${item.name}</div>`; }); let categoriesHtml=''; state.groupingData.categories.forEach(category=>{ let itemsHtml=''; state.groupingData.groups[category].forEach(item=>{ const className=item.category===category?'grouped-item correct':'grouped-item incorrect'; itemsHtml+=`<div class="${className}">${item.name}</div>`; }); categoriesHtml+=`<div class="category-box" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop('${category}',event)"><div class="category-title">${category}</div><div class="category-items">${itemsHtml}</div></div>`; }); const allGrouped=state.groupingData.ungrouped.length===0; return `${renderControlBar()}<div class="grouping-container"><div class="text-center mb-6"><h2 class="question-title">ã‚«ãƒ†ã‚´ãƒªåˆ†é¡</h2><p class="question-subtitle">äººç‰©ã‚’é©åˆ‡ãªã‚«ãƒ†ã‚´ãƒªã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„</p><div style="margin-top:1rem;font-size:1.25rem;font-weight:bold;color:#b45309;">æ­£è§£: ${state.score}</div></div><div class="mb-6"><div class="ungrouped-title">æœªåˆ†é¡</div><div class="ungrouped-area">${ungroupedHtml||'<div style="color:#9ca3af;">å…¨ã¦ã®é …ç›®ãŒåˆ†é¡ã•ã‚Œã¾ã—ãŸ</div>'}</div></div><div class="categories-grid">${categoriesHtml}</div>${allGrouped?'<button class="menu-btn" onclick="resetToMenu()" style="margin-top:2rem;">çµæœã‚’è¦‹ã‚‹ â†’</button>':''}</div>`; }
function renderTimeline() { let itemsHtml=''; state.timelineData.items.forEach((item,idx)=>{ itemsHtml+=`<div class="sortable-item" draggable="true" ondragstart="handleTimelineDragStart(${idx},event)" ondragend="handleTimelineDragEnd(event)" ondragover="handleTimelineDragOver(event)" ondrop="handleTimelineDrop(${idx},event)"><div class="drag-handle">â‹®â‹®</div><div class="item-content">${item.name} (${item.dynasty})</div></div>`; }); return `${renderControlBar()}<div class="timeline-container"><div class="text-center mb-6"><h2 class="question-title">æ™‚ä»£é †ä¸¦ã¹æ›¿ãˆ</h2><p class="question-subtitle">äººç‰©ã‚’å¤ã„æ™‚ä»£ã‹ã‚‰æ–°ã—ã„æ™‚ä»£ã®é †ã«ä¸¦ã¹æ›¿ãˆã¦ãã ã•ã„</p></div><div class="sortable-list">${itemsHtml}</div><button class="submit-btn" onclick="submitTimeline()">è§£ç­”ã‚’ç¢ºå®š</button></div>`; }
function renderResults() { let total,percentage; if(state.previousMode==='timeline'){ total=state.timelineData.items.length; percentage=Math.round((state.score/total)*100); }else if(state.previousMode==='matching'){ total=6; percentage=Math.round((state.score/total)*100); }else if(state.previousMode==='grouping'){ total=12; percentage=Math.round((state.score/total)*100); }else{ total=state.quizQuestions.length; percentage=Math.round((state.score/total)*100); } return `<div style="min-height:100vh;display:flex;align-items:center;justify-content:center;"><div class="results-box"><h2 class="results-title">çµæœ</h2><div class="results-score">${state.score} / ${total}</div><div class="results-percentage">æ­£ç­”ç‡: ${percentage}%</div><div class="results-buttons"><button class="menu-btn" onclick="resetToMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button><button class="retry-btn" onclick="startQuiz('${state.previousMode}')">ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button></div></div></div>`; }
function render() { const app=document.getElementById('app'); let content=''; if(state.mode==='menu'){ content=renderMenu(); }else if(state.mode==='person-to-dynasty'||state.mode==='dynasty-to-people'){ content=renderQuiz(); }else if(state.mode==='truefalse'){ content=renderTrueFalse(); }else if(state.mode==='matching'){ content=renderMatching(); }else if(state.mode==='grouping'){ content=renderGrouping(); }else if(state.mode==='timeline'){ content=renderTimeline(); }else if(state.mode==='results'){ content=renderResults(); } app.innerHTML=content; }
render();
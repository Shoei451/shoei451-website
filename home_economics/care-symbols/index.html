<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../../images/favicon.png">
    <title>衣類取り扱い表示クイズ — Shoei451</title>
    <link rel="stylesheet" href="../../css/care-symbols-style.css">
</head>
<body>
    <!-- Theme Toggle -->
    <div class="logo-switches">
        <button id="theme-toggle" aria-label="Toggle theme">
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>
    </div>

    <div class="quiz-wrapper">
        <h1>👔 衣類取り扱い表示クイズ</h1>

        <!-- Start Screen -->
        <div id="startScreen" class="screen">
            <h2></h2>
            <p class="note">衣類の取り扱い表示記号（JIS L 0001）を学習します。マークを見て、正しい意味を選びましょう。<br>
            「素材特定モード」では、<u>ぜひ問題を追加していってください。</u>服の裏タグのマークと素材構成を入力して、作問できます。</p>
            
            <div class="explanation">
                <h3>📋 クイズモード</h3>
                <ul>
                    <li><strong>基本モード:</strong> マークを見て意味を4択で答える</li>
                    <li><strong>素材特定モード:</strong> 実際の衣類を見て、表示の組み合わせから素材を特定する練習（27種類の素材に対応）</li>
                </ul>
                <p style="margin-top: 12px; font-size: 0.9em; color: var(--secondary);">
                    ※ 画像は「ICOMPO」の商用フリー素材を使用しています
                </p>
            </div>

            <div class="mode-selection">
                <button class="mode-btn" onclick="selectMode('basic')">
                    <span class="mode-icon">📝</span>
                    <span class="mode-title">基本モード</span>
                    <span class="mode-desc">マークの意味を覚える</span>
                </button>
                <button class="mode-btn" onclick="selectMode('material')">
                    <span class="mode-icon">🔍</span>
                    <span class="mode-title">素材特定モード</span>
                    <span class="mode-desc">実際の服から素材を推測</span>
                </button>
            </div>
        </div>

        <!-- Basic Mode Settings -->
        <div id="basicSettings" class="screen hidden">
            <div class="top-bar">
                <button onclick="backToStart()">戻る</button>
                <h2>基本モード - 設定</h2>
            </div>

            <div class="field">
                <label for="categorySelect"><b>出題カテゴリー</b></label>
                <select id="categorySelect">
                    <option value="all">全カテゴリー</option>
                    <option value="washing">洗濯処理</option>
                    <option value="bleaching">漂白処理</option>
                    <option value="drying">乾燥処理</option>
                    <option value="ironing">アイロン仕上げ</option>
                    <option value="cleaning">クリーニング</option>
                </select>
            </div>
            
            <div class="field">
                <label for="questionCount"><b>出題数</b></label>
                <select id="questionCount">
                    <option value="5">5問</option>
                    <option value="10" selected>10問</option>
                    <option value="20">20問</option>
                    <option value="all">全問</option>
                </select>
            </div>

            <div class="field">
                <label for="quizMode"><b>学習モード</b></label>
                <select id="quizMode">
                    <option value="random">ランダム練習</option>
                    <option value="difficult">弱点克服（正答率50%未満）</option>
                    <option value="unattempted">未学習問題</option>
                </select>
            </div>
            
            <button id="startBasicBtn" class="primary">クイズ開始</button>
        </div>

        <!-- Material Mode -->
        <div id="materialMode" class="screen hidden">
            <div class="top-bar">
                <button onclick="backToStart()">戻る</button>
                <h2>素材特定モード</h2>
            </div>

            <div class="material-menu">
                <button class="mode-select-btn" onclick="showMaterialQuiz()">
                    <span class="mode-icon">🎯</span>
                    <span>クイズに挑戦</span>
                </button>
                <button class="mode-select-btn" onclick="showAddMaterial()">
                    <span class="mode-icon">➕</span>
                    <span>問題を追加</span>
                </button>
            </div>
        </div>

        <!-- Material Quiz Screen -->
        <div id="materialQuizScreen" class="screen hidden">
            <div class="top-bar">
                <button onclick="backToMaterialMode()">戻る</button>
                <div id="materialScore">スコア: 0/0</div>
            </div>

            <div id="materialProgressOuter">
                <div id="materialProgressBar"></div>
            </div>

            <h3 style="text-align: center; margin-bottom: 20px;">この服の素材構成は？</h3>

            <div class="symbols-display">
                <h4>洗濯表示記号:</h4>
                <div id="materialSymbolsDisplay" class="symbols-row">
                    <!-- 記号画像を表示 -->
                </div>
            </div>

            <div id="materialQuestion">円グラフから正しい素材構成を選んでください</div>

            <div id="pieChartChoices" class="pie-chart-grid">
                <!-- 円グラフの選択肢を表示 -->
            </div>

            <div id="materialFeedback" class="feedback hidden"></div>
            <button id="materialNextBtn" class="hidden">次の問題</button>
        </div>

        <!-- Material Results Screen -->
        <div id="materialResultsScreen" class="screen hidden">
            <h2>素材特定クイズ完了！</h2>
            <div id="materialFinalScore"></div>
            <button id="materialRestartBtn">もう一度挑戦</button>
            <button onclick="backToMaterialMode()" class="ghost">素材モードに戻る</button>
        </div>

        <!-- Add Material Screen -->
        <div id="addMaterialScreen" class="screen hidden">
            <div class="top-bar">
                <button onclick="backToMaterialMode()">戻る</button>
                <h2>問題を追加</h2>
            </div>

            <div class="add-material-form">
                <div class="field">
                    <label><b>服の名前:</b></label>
                    <input type="text" id="itemName" placeholder="例: 白いハンカチ、セーター" />
                </div>

                <div class="field">
                    <label><b>洗濯表示記号を選択（複数可）:</b></label>
                    <!-- カテゴリータブ -->
                     <div class="symbol-category-tabs">
                        <button class="symbol-tab active" data-category="washing">🧺 洗濯</button>
                        <button class="symbol-tab" data-category="bleaching">🧴 漂白</button>
                        <button class="symbol-tab" data-category="drying">🌤️ 乾燥</button>
                        <button class="symbol-tab" data-category="ironing">🔥 アイロン</button>
                        <button class="symbol-tab" data-category="cleaning">🧼 クリーニング</button>
                    </div>
                    <!-- 記号グリッド -->
                     <div id="addSymbolSelector" class="symbol-grid">
                        <!-- JavaScript で生成 -->
                    </div>
                        <!-- 選択中の記号表示 -->
                         <div id="selectedSymbolsDisplay" class="selected-symbols-display">
                            <strong>選択中: </strong>
                            <span id="selectedSymbolsCount">0個</span>
                        </div>
                </div>

                <div class="field">
                    <label><b>素材の割合（合計100%）:</b></label>
                    
                    <!-- 素材スライダーを動的に生成 -->
                    <div id="materialSlidersContainer">
                        <!-- JavaScriptで動的生成 -->
                    </div>

                    <div id="totalPercentage" class="total-display">合計: 0%</div>
                </div>

                <div class="field">
                    <label>追加者の名前（任意）:</label>
                    <input type="text" id="createdBy" placeholder="例: 山田太郎" />
                </div>

                <button id="submitMaterialDataBtn" class="primary">問題を追加</button>
                <div id="addMaterialMessage" class="hidden"></div>
            </div>
        </div>

        <!-- Quiz Screen (Basic Mode) -->
        <div id="quizScreen" class="screen hidden">
            <div class="top-bar">
                <button id="homeBtn">最初に戻る</button>
                <div id="score">スコア: 0/0</div>
            </div>
            
            <div id="progressOuter">
                <div id="progressBar"></div>
            </div>

            <div id="categoryBadge" class="category-badge"></div>
            
            <div class="symbol-display">
                <img id="symbolImage" src="" alt="洗濯表示記号" />
            </div>

            <div id="question">この記号の意味は？</div>
            <div id="choices"></div>

            <div id="feedback" class="feedback hidden"></div>
            <button id="nextBtn" class="hidden">次の問題</button>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="screen hidden">
            <h2>クイズ完了！</h2>
            <div id="finalScore"></div>
            <div id="categoryBreakdown" class="category-breakdown"></div>
            <button id="restartBtn">もう一度挑戦</button>
            <button id="reviewBtn" class="ghost">間違えた問題を復習</button>
        </div>

        <div id="loading" class="loading hidden">読み込み中...</div>
        <div id="error" class="error hidden"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="materials-master.js"></script>
    <script src="care-symbols-data.js"></script>
    <script src="care-symbols-logic.js"></script>
</body>
</html>